<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Web Scraper & Knowledge Graph Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
    <!-- Animated background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse"></div>
        <div class="absolute top-3/4 right-1/4 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-xl opacity-20 animate-pulse animation-delay-2000"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-12">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full mb-6 animate-bounce">
                    <i class="fas fa-spider text-3xl"></i>
                </div>
                <h1 class="text-5xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent mb-4">
                    Free Web Scraper
                </h1>
                <p class="text-xl text-gray-300 max-w-2xl mx-auto">
                    Extract knowledge graphs from any website using completely free, open-source tools. 
                    No API keys required!
                </p>
            </div>

            <!-- Main Interface -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column: Input Form -->
                <div class="lg:col-span-2">
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/20">
                        <h2 class="text-2xl font-bold mb-6 flex items-center">
                            <i class="fas fa-rocket mr-3 text-purple-400"></i>
                            Start Scraping
                        </h2>
                        
                        <form id="scrapeForm" class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">
                                    <i class="fas fa-globe mr-2"></i>Website URL
                                </label>
                                <input 
                                    type="url" 
                                    id="urlInput" 
                                    placeholder="https://example.com"
                                    class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-white placeholder-gray-400"
                                    required
                                >
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        <i class="fas fa-cogs mr-2"></i>Extraction Type
                                    </label>
                                    <select 
                                        id="extractType"
                                        class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:ring-2 focus:ring-purple-500 text-white"
                                    >
                                        <option value="entities_relationships">üß† Entities & Relationships</option>
                                        <option value="links_only">üîó Links Only</option>
                                        <option value="text_summary">üìù Text Summary</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">
                                        <i class="fas fa-layer-group mr-2"></i>Max Pages
                                    </label>
                                    <select 
                                        id="maxPages"
                                        class="w-full px-4 py-3 bg-white/10 border border-white/30 rounded-lg focus:ring-2 focus:ring-purple-500 text-white"
                                    >
                                        <option value="1">1 page</option>
                                        <option value="3" selected>3 pages</option>
                                        <option value="5">5 pages</option>
                                        <option value="10">10 pages</option>
                                    </select>
                                </div>
                            </div>

                            <button 
                                type="submit"
                                class="w-full bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-bold py-4 px-8 rounded-lg transition duration-300 transform hover:scale-105 shadow-lg"
                                id="submitBtn"
                            >
                                <i class="fas fa-play mr-2"></i>
                                Start Free Scraping
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Right Column: Quick Actions -->
                <div class="space-y-6">
                    <!-- Recent Results -->
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                        <h3 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fas fa-history mr-2 text-green-400"></i>
                            Recent Results
                        </h3>
                        <div id="recentResults" class="space-y-3">
                            <div class="text-gray-400 text-sm">No recent results yet</div>
                        </div>
                        <button 
                            onclick="loadRecentResults()"
                            class="mt-4 w-full bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg transition duration-200"
                        >
                            <i class="fas fa-refresh mr-2"></i>Refresh
                        </button>
                    </div>

                    <!-- GitHub Status -->
                    <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                        <h3 class="text-lg font-bold mb-4 flex items-center">
                            <i class="fab fa-github mr-2 text-gray-400"></i>
                            GitHub Actions
                        </h3>
                        <div id="githubStatus" class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-300">Status:</span>
                                <span id="workflowStatus" class="text-xs bg-gray-600 px-2 py-1 rounded">Unknown</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-300">Last Run:</span>
                                <span id="lastRun" class="text-xs text-gray-400">-</span>
                            </div>
                        </div>
                        <button 
                            onclick="triggerGithubAction()"
                            class="mt-4 w-full bg-gradient-to-r from-gray-600 to-gray-700 hover:from-gray-700 hover:to-gray-800 text-white px-4 py-2 rounded-lg transition duration-200"
                            id="githubTriggerBtn"
                        >
                            <i class="fas fa-cloud mr-2"></i>Run on GitHub
                        </button>
                    </div>
                </div>
            </div>

            <!-- Status Section -->
            <div id="statusSection" class="hidden mt-8">
                <div class="bg-yellow-500/20 backdrop-blur-md rounded-2xl p-6 border border-yellow-500/30">
                    <div class="flex items-center mb-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-400 mr-4"></div>
                        <div>
                            <h3 class="text-lg font-bold text-yellow-300">Processing</h3>
                            <p id="statusText" class="text-yellow-200">Initializing scraper...</p>
                        </div>
                    </div>
                    <div class="bg-yellow-900/50 rounded-full h-3 mb-2">
                        <div id="progressBar" class="bg-gradient-to-r from-yellow-400 to-orange-400 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <div id="progressText" class="text-xs text-yellow-300">0% complete</div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden mt-8">
                <div class="bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/20">
                    <h2 class="text-3xl font-bold mb-6 flex items-center">
                        <i class="fas fa-chart-network mr-3 text-green-400"></i>
                        Extraction Results
                    </h2>
                    
                    <!-- Summary Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-blue-500/20 to-blue-600/20 p-6 rounded-xl border border-blue-400/30">
                            <div class="text-3xl font-bold text-blue-400" id="entityCount">0</div>
                            <div class="text-sm text-blue-200">Entities Found</div>
                        </div>
                        <div class="bg-gradient-to-r from-green-500/20 to-green-600/20 p-6 rounded-xl border border-green-400/30">
                            <div class="text-3xl font-bold text-green-400" id="relationshipCount">0</div>
                            <div class="text-sm text-green-200">Relationships</div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500/20 to-purple-600/20 p-6 rounded-xl border border-purple-400/30">
                            <div class="text-3xl font-bold text-purple-400" id="pageCount">0</div>
                            <div class="text-sm text-purple-200">Pages Scraped</div>
                        </div>
                        <div class="bg-gradient-to-r from-orange-500/20 to-orange-600/20 p-6 rounded-xl border border-orange-400/30">
                            <div class="text-3xl font-bold text-orange-400" id="processingTime">0s</div>
                            <div class="text-sm text-orange-200">Processing Time</div>
                        </div>
                    </div>

                    <!-- Tabs -->
                    <div class="flex space-x-4 mb-6 border-b border-white/20">
                        <button onclick="showTab('entities')" class="tab-button active px-6 py-3 font-medium transition duration-200" data-tab="entities">
                            <i class="fas fa-tags mr-2"></i>Entities
                        </button>
                        <button onclick="showTab('relationships')" class="tab-button px-6 py-3 font-medium transition duration-200" data-tab="relationships">
                            <i class="fas fa-sitemap mr-2"></i>Relationships
                        </button>
                        <button onclick="showTab('graph')" class="tab-button px-6 py-3 font-medium transition duration-200" data-tab="graph">
                            <i class="fas fa-project-diagram mr-2"></i>Graph View
                        </button>
                    </div>

                    <!-- Tab Content -->
                    <div id="entitiesTab" class="tab-content">
                        <div id="entitiesList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                    </div>

                    <div id="relationshipsTab" class="tab-content hidden">
                        <div id="relationshipsList" class="space-y-4"></div>
                    </div>

                    <div id="graphTab" class="tab-content hidden">
                        <div class="bg-white/5 rounded-xl p-6 text-center">
                            <i class="fas fa-project-diagram text-6xl text-gray-400 mb-4"></i>
                            <p class="text-gray-300">Interactive graph visualization coming soon!</p>
                            <p class="text-sm text-gray-400 mt-2">For now, download the Neo4j file to visualize in Neo4j Browser</p>
                        </div>
                    </div>

                    <!-- Download Section -->
                    <div class="mt-8 pt-6 border-t border-white/20">
                        <h3 class="text-xl font-bold mb-4">üì• Download Results</h3>
                        <div class="flex flex-wrap gap-4">
                            <button 
                                onclick="downloadJSON()"
                                class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-lg transition duration-200 transform hover:scale-105 shadow-lg"
                            >
                                <i class="fas fa-file-code mr-2"></i>JSON Data
                            </button>
                            <button 
                                onclick="downloadCypher()"
                                class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-3 rounded-lg transition duration-200 transform hover:scale-105 shadow-lg"
                            >
                                <i class="fas fa-database mr-2"></i>Neo4j Queries
                            </button>
                            <button 
                                onclick="downloadCSV()"
                                class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg transition duration-200 transform hover:scale-105 shadow-lg"
                            >
                                <i class="fas fa-table mr-2"></i>CSV Export
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Documentation -->
            <div class="mt-12 bg-white/10 backdrop-blur-md rounded-2xl p-8 border border-white/20">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i class="fas fa-code mr-3 text-blue-400"></i>
                    API Access
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium mb-3 text-green-400">Direct API Call</h3>
                        <div class="bg-black/30 rounded-lg p-4 font-mono text-sm">
                            <pre id="apiExample" class="text-green-300">curl -X POST https://your-vercel-app.vercel.app/api/scrape \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com"}'</pre>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium mb-3 text-purple-400">GitHub Action Trigger</h3>
                        <div class="bg-black/30 rounded-lg p-4 font-mono text-sm">
                            <pre class="text-purple-300">curl -X POST \
  https://api.github.com/repos/yourusername/web-scraper/actions/workflows/scraping.yml/dispatches \
  -H "Authorization: token YOUR_TOKEN" \
  -d '{"ref": "main", "inputs": {"start_url": "https://example.com"}}'</pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .tab-button.active {
            @apply text-purple-400 border-b-2 border-purple-400;
        }
        .tab-button {
            @apply text-gray-400 hover:text-white border-b-2 border-transparent;
        }
        .animation-delay-2000 {
            animation-delay: 2s;
        }
    </style>

    <script>
        let currentData = null;
        let startTime = null;

        // Form submission
        document.getElementById('scrapeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const url = document.getElementById('urlInput').value;
            const extractType = document.getElementById('extractType').value;
            const maxPages = document.getElementById('maxPages').value;
            
            startTime = Date.now();
            await startScraping(url, extractType, maxPages);
        });

        async function startScraping(url, extractType, maxPages) {
            showStatus('üöÄ Triggering GitHub Action...');
            updateProgress(10, 'Initializing...');
            
            try {
                // Try to trigger GitHub Action
                const response = await fetch('https://api.github.com/repos/yourusername/web-scraper/actions/workflows/scraping.yml/dispatches', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ref: 'main',
                        inputs: {
                            start_url: url,
                            extract_type: extractType,
                            max_pages: maxPages
                        }
                    })
                });

                if (response.status === 204) {
                    // GitHub Action triggered successfully
                    await pollForResults(url);
                } else {
                    // Fallback to mock demo
                    console.log('GitHub Action trigger failed, running demo mode');
                    await runDemoScraping(url, extractType);
                }
                
            } catch (error) {
                console.log('Error triggering GitHub Action, running demo:', error);
                await runDemoScraping(url, extractType);
            }
        }

        async function pollForResults() {
            showStatus('‚è≥ Waiting for GitHub Action to complete...');
            updateProgress(30, 'Processing on GitHub...');
            
            // Simulate polling (in real implementation, you'd check GitHub API)
            for (let i = 0; i < 10; i++) {
                await new Promise(resolve => setTimeout(resolve, 2000));
                updateProgress(30 + (i * 5), `Processing... ${i + 1}/10`);
                
                // Try to fetch results
                try {
                    const response = await fetch('./data/scraping_summary.json');
                    if (response.ok) {
                        const results = await response.json();
                        displayResults(results.data);
                        return;
                    }
                } catch (e) {
                    // Continue polling
                }
            }
            
            // If no results found, show demo
            showStatus('‚ö†Ô∏è Results not found, showing demo data...');
            setTimeout(() => runDemoScraping('demo', 'entities_relationships'), 1000);
        }

        async function runDemoScraping(url, extractType) {
            const steps = [
                'üåê Fetching webpage content...',
                'üß† Processing with free AI models...',
                'üè∑Ô∏è Extracting entities...',
                'üîó Finding relationships...',
                'üíæ Saving results...',
                '‚úÖ Complete!'
            ];

            for (let i = 0; i < steps.length; i++) {
                showStatus(steps[i]);
                updateProgress((i + 1) * (90 / steps.length), steps[i]);
                await new Promise(resolve => setTimeout(resolve, 800));
            }

            // Generate demo data based on URL
            const mockData = generateDemoData(url);
            currentData = [mockData];
            displayResults(currentData);
        }

        function generateDemoData(url) {
            const domain = new URL(url).hostname;
            
            return {
                entities: [
                    { name: "Web Scraping", description: "Automated data extraction from websites" },
                    { name: domain, description: `Website domain: ${domain}` },
                    { name: "Knowledge Graph", description: "Structured representation of information and relationships" },
                    { name: "GitHub Actions", description: "CI/CD platform for automated workflows" },
                    { name: "Neo4j", description: "Graph database management system" },
                    { name: "Free Tools", description: "Open source and free-tier services for web scraping" }
                ],
                relationships: [
                    {
                        entity1: { name: "Web Scraping" },
                        entity2: { name: domain },
                        relation_type: "EXTRACTS_FROM",
                        description: `Web scraping extracts data from ${domain}`
                    },
                    {
                        entity1: { name: "Web Scraping" },
                        entity2: { name: "Knowledge Graph" },
                        relation_type: "CREATES",
                        description: "Web scraping creates structured knowledge graphs"
                    },
                    {
                        entity1: { name: "GitHub Actions" },
                        entity2: { name: "Free Tools" },
                        relation_type: "USES",
                        description: "GitHub Actions uses free tools for processing"
                    },
                    {
                        entity1: { name: "Knowledge Graph" },
                        entity2: { name: "Neo4j" },
                        relation_type: "STORED_IN",
                        description: "Knowledge graphs can be stored in Neo4j databases"
                    }
                ],
                source_url: url,
                error: false
            };
        }

        function showStatus(message) {
            document.getElementById('statusSection').classList.remove('hidden');
            document.getElementById('statusText').textContent = message;
            document.getElementById('resultsSection').classList.add('hidden');
        }

        function updateProgress(percent, text = null) {
            document.getElementById('progressBar').style.width = percent + '%';
            if (text) {
                document.getElementById('progressText').textContent = `${Math.round(percent)}% - ${text}`;
            }
        }

        function displayResults(data) {
            document.getElementById('statusSection').classList.add('hidden');
            document.getElementById('resultsSection').classList.remove('hidden');

            let totalEntities = 0;
            let totalRelationships = 0;
            let totalPages = data.length;

            // Calculate stats
            data.forEach(item => {
                if (!item.error) {
                    totalEntities += item.entities?.length || 0;
                    totalRelationships += item.relationships?.length || 0;
                }
            });

            // Update stats
            document.getElementById('entityCount').textContent = totalEntities;
            document.getElementById('relationshipCount').textContent = totalRelationships;
            document.getElementById('pageCount').textContent = totalPages;
            
            if (startTime) {
                const processingTime = Math.round((Date.now() - startTime) / 1000);
                document.getElementById('processingTime').textContent = `${processingTime}s`;
            }

            // Display entities
            const entitiesList = document.getElementById('entitiesList');
            entitiesList.innerHTML = '';
            
            data.forEach((item, pageIndex) => {
                if (!item.error && item.entities) {
                    item.entities.forEach(entity => {
                        const entityDiv = document.createElement('div');
                        entityDiv.className = 'bg-blue-500/20 p-4 rounded-xl border border-blue-400/30 hover:bg-blue-500/30 transition duration-200';
                        entityDiv.innerHTML = `
                            <div class="font-semibold text-blue-300 text-lg">${entity.name}</div>
                            <div class="text-sm text-gray-300 mt-2">${entity.description}</div>
                            <div class="text-xs text-blue-400 mt-2">Page ${pageIndex + 1}</div>
                        `;
                        entitiesList.appendChild(entityDiv);
                    });
                }
            });

            // Display relationships
            const relationshipsList = document.getElementById('relationshipsList');
            relationshipsList.innerHTML = '';
            
            data.forEach((item, pageIndex) => {
                if (!item.error && item.relationships) {
                    item.relationships.forEach(rel => {
                        const relDiv = document.createElement('div');
                        relDiv.className = 'bg-green-500/20 p-4 rounded-xl border border-green-400/30 hover:bg-green-500/30 transition duration-200';
                        relDiv.innerHTML = `
                            <div class="flex items-center justify-between mb-2">
                                <div class="font-semibold text-green-300">
                                    ${rel.entity1.name} 
                                    <i class="fas fa-arrow-right mx-2 text-green-400"></i>
                                    ${rel.entity2.name}
                                </div>
                                <span class="text-xs bg-green-600/50 px-2 py-1 rounded text-green-200">${rel.relation_type}</span>
                            </div>
                            <div class="text-sm text-gray-300">${rel.description}</div>
                            <div class="text-xs text-green-400 mt-2">Page ${pageIndex + 1}</div>
                        `;
                        relationshipsList.appendChild(relDiv);
                    });
                }
            });
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-purple-400', 'border-purple-400');
                btn.classList.add('text-gray-400');
            });
            
            // Show selected tab
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Add active class to selected button
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.classList.add('active', 'text-purple-400', 'border-purple-400');
            activeBtn.classList.remove('text-gray-400');
        }

        function downloadJSON() {
            if (!currentData) return;
            
            const dataStr = JSON.stringify(currentData, null, 2);
            downloadFile(dataStr, `knowledge_graph_${new Date().toISOString().slice(0,10)}.json`, 'application/json');
        }

        function downloadCypher() {
            if (!currentData) return;
            
            let cypherQueries = [];
            
            // Add header comments
            cypherQueries.push('// Neo4j Knowledge Graph Import');
            cypherQueries.push(`// Generated: ${new Date().toISOString()}`);
            cypherQueries.push('// Source: Free Web Scraper');
            cypherQueries.push('');
            cypherQueries.push('// Clear existing data (optional)');
            cypherQueries.push('// MATCH (n) DETACH DELETE n;');
            cypherQueries.push('');
            cypherQueries.push('// Create constraints');
            cypherQueries.push('CREATE CONSTRAINT entity_name_unique IF NOT EXISTS FOR (e:Entity) REQUIRE e.name IS UNIQUE;');
            cypherQueries.push('');
            
            currentData.forEach((item, index) => {
                if (!item.error) {
                    cypherQueries.push(`// Data from page ${index + 1}: ${item.source_url || 'unknown'}`);
                    
                    // Entities
                    if (item.entities) {
                        cypherQueries.push('// Entities');
                        item.entities.forEach(entity => {
                            const name = entity.name.replace(/"/g, '\\"');
                            const desc = entity.description.replace(/"/g, '\\"');
                            cypherQueries.push(`MERGE (e:Entity {name: "${name}"}) SET e.description = "${desc}";`);
                        });
                    }
                    
                    cypherQueries.push('');
                    
                    // Relationships
                    if (item.relationships) {
                        cypherQueries.push('// Relationships');
                        item.relationships.forEach(rel => {
                            const name1 = rel.entity1.name.replace(/"/g, '\\"');
                            const name2 = rel.entity2.name.replace(/"/g, '\\"');
                            const relType = rel.relation_type.replace(/"/g, '\\"');
                            const desc = rel.description.replace(/"/g, '\\"');
                            
                            cypherQueries.push(`MATCH (e1:Entity {name: "${name1}"})`);
                            cypherQueries.push(`MATCH (e2:Entity {name: "${name2}"})`);
                            cypherQueries.push(`MERGE (e1)-[r:RELATES_TO {type: "${relType}", description: "${desc}"}]->(e2);`);
                        });
                    }
                    
                    cypherQueries.push('');
                }
            });

            const cypherStr = cypherQueries.join('\n');
            downloadFile(cypherStr, `neo4j_import_${new Date().toISOString().slice(0,10)}.cypher`, 'text/plain');
        }

        function downloadCSV() {
            if (!currentData) return;
            
            let csvContent = 'Type,Name,Description,Source,Page\n';
            
            currentData.forEach((item, pageIndex) => {
                if (!item.error) {
                    // Add entities
                    if (item.entities) {
                        item.entities.forEach(entity => {
                            csvContent += `Entity,"${entity.name}","${entity.description}","${item.source_url || ''}",${pageIndex + 1}\n`;
                        });
                    }
                    
                    // Add relationships
                    if (item.relationships) {
                        item.relationships.forEach(rel => {
                            csvContent += `Relationship,"${rel.entity1.name} -> ${rel.entity2.name}","${rel.description}","${item.source_url || ''}",${pageIndex + 1}\n`;
                        });
                    }
                }
            });
            
            downloadFile(csvContent, `knowledge_graph_${new Date().toISOString().slice(0,10)}.csv`, 'text/csv');
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        async function triggerGithubAction() {
            const url = document.getElementById('urlInput').value;
            if (!url) {
                alert('Please enter a URL first');
                return;
            }
            
            await startScraping(url, document.getElementById('extractType').value, document.getElementById('maxPages').value);
        }

        async function loadRecentResults() {
            try {
                const response = await fetch('./data/status.json');
                if (response.ok) {
                    const status = await response.json();
                    
                    const recentDiv = document.getElementById('recentResults');
                    recentDiv.innerHTML = `
                        <div class="bg-green-500/20 p-3 rounded-lg border border-green-400/30">
                            <div class="font-medium text-green-300">Last Successful Run</div>
                            <div class="text-sm text-gray-300">${new Date(status.timestamp).toLocaleString()}</div>
                            <div class="text-xs text-green-400">${status.url_scraped}</div>
                        </div>
                    `;
                    
                    document.getElementById('workflowStatus').textContent = 'Active';
                    document.getElementById('workflowStatus').className = 'text-xs bg-green-600 px-2 py-1 rounded';
                    document.getElementById('lastRun').textContent = new Date(status.timestamp).toLocaleString();
                }
            } catch (error) {
                console.log('No recent results found');
            }
        }

        // Auto-populate demo data and load recent results
        window.addEventListener('load', () => {
            document.getElementById('urlInput').value = 'https://crawl4ai.com/';
            loadRecentResults();
            
            // Update API example with current domain
            const apiExample = document.getElementById('apiExample');
            const currentDomain = window.location.hostname;
            if (currentDomain !== 'localhost') {
                apiExample.textContent = apiExample.textContent.replace('your-vercel-app.vercel.app', currentDomain);
            }
        });

        // Auto-add https:// if missing
        document.getElementById('urlInput').addEventListener('input', (e) => {
            const url = e.target.value;
            if (url && !url.startsWith('http') && url.includes('.')) {
                e.target.value = 'https://' + url;
            }
        });
    </script>
</body>
</html>
